# Домашнее задание к занятию "`Резервное копирование баз данных`" - `Гривняшкин Роман`  

---  
  
### Задание 1  
  
1.1 `Ежеднеынй ночной Full-Backup.`   
1.2 `Ежечасный инкрементный бэкап. В частности для фин. организаций - журналирование транзакций (WAL).`  
1.3* `Ну или multi-master, если это оправдывает сложность, или Master-Slave репликация с автоматическим переключением (Failover). Вопрос требований RPO`  
  
---  
  
### Задание 2  
  
2.1 `'pg_dump -h {host1} -p {port} -U {user} -d {database} -С | psql -h {host2} -p {port} -U {user} -d {database}' - для репликации одной командой.`  
`'-С' добавляет в дамп запрос на создание БД, но pg_restore работает только с уже существующей.`  
  
`Для восстановления в случае тотальной аннигиляции:`  
`'pg_dump -h {host} -p {port} -U {user} -d {database} > dump.sql' - создание дампа.`  
`'psql -h {host1} -p {port} -U {user} -d {database} CREATE DATABASE {database};' - создание БД.`  
`'pg_restore -h {host} -p {port} -U {user} -d {database} dump.sql' - восстановление.`  
  
2.2* `Для автоматизации можно использовать скрипт с комбинацией вышеописанных команд и планировщик.`  
  
### Задание 3  
  
`3.1Сначала делаем полный бэкап:`  
`'mysqldump -u root -p --all-databases --single-transaction --flush-logs --master-data=2 > /backups/full_backup.sql'`  
  
`Принудим начать новый лог:`  
`'mysqladmin -u root -p flush-logs'`  
  
`Копируем бинарные логи:`  
`'cp /var/lib/mysql/mysql-bin.<some_count> /backups/incremental/'`  
  
`Восстанавливаем полный бэкап:`  
`'mysql -u root -p < /backups/full_backup.sql'`  
  
`И добавляем инкременты:`  
`'mysqlbinlog /backups/incremental/mysql-bin.<some_count> | mysql -u root -p'`  
  
`Нужно копировать все инкременты и добавлять по очереди. Разумеется это все можно сделать через цикл bash-скрипта.`  
  
`3.2*`  
`По правде говоря, не вполне уверен в корректности вопроса. Бэкап и реплицирование - это суть вещи разные и нужны оба.`  
`Бэкап - резервирование данных. Гарантирует сохранность данных, но не гарантирует их доступность.`  
`Репликация - резервирование мощностей. Гарантирует доступность данных, но не гарантирует их сохранность.`  
`Кого ты любишь больше: папу или маму?`  